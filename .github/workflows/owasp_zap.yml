name: OWASP ZAP SCAN
on: [push]

jobs:
  test:
    name: OWASP ZAP SCANS
    runs-on: ubuntu-latest

    steps:
       - uses: actions/checkout@v2
         with:
          ref: master
          
       - name: Create Docker Network
         run: |
          docker network create mynetwork
          docker-compose build
          docker-compose up --detach 
          docker ps 
          docker network connect mynetwork docker-compose_application_web_1
          docker network connect mynetwork docker-compose_application_mongo_1
          docker network inspect mynetwork
          
       - name: Set up testing environment
         run: |
            docker run -d -i -t --network=mynetwork --name OWASPZAP -v $(pwd):/zap/wrk/:rw owasp/zap2docker-stable
            docker ps
       
       - name: Copy test files to the OWASP ZAP image
         run: docker cp OWASPZAP_scanns/normal_scann_no_fail_on_warning.yaml OWASPZAP:/zap/normal_scann_no_fail_on_warning.yaml 

       - name: Execute the scan
         run: docker exec -i OWASPZAP zap.sh -cmd -autorun /zap/normal_scann_no_fail_on_warning.yaml
       

            
      
